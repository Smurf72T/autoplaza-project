<!-- templates/users/login.html -->
{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Вход в аккаунт | Autoplaza{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <!-- Карточка входа -->
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4 p-md-5">
                    <!-- Логотип и заголовок -->
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="fas fa-car fa-3x text-primary"></i>
                        </div>
                        <h1 class="h3 mb-0">Вход в Autoplaza</h1>
                        <p class="text-muted">Войдите в свой аккаунт</p>
                    </div>

                    <!-- Форма входа -->
                    <form method="post" action="{% url 'users:login' %}" novalidate>
                        {% csrf_token %}

                        {% if next %}
                        <input type="hidden" name="next" value="{{ next }}">
                        {% endif %}

                        <!-- Сообщения об ошибках -->
                        {% if form.errors %}
                        <div class="alert alert-danger alert-dismissible fade show">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Неверное имя пользователя или пароль.
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endif %}

                        <!-- Сообщения системы -->
                        {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Поля формы -->
                        <div class="mb-3">
                            <label for="id_username" class="form-label">
                                <i class="fas fa-user me-1"></i>Имя пользователя или Email
                            </label>
                            <input type="text"
                                   name="username"
                                   id="id_username"
                                   class="form-control form-control-lg"
                                   placeholder="Введите имя пользователя или email"
                                   required
                                   autofocus>
                        </div>

                        <div class="mb-3">
                            <label for="id_password" class="form-label">
                                <i class="fas fa-lock me-1"></i>Пароль
                            </label>
                            <div class="input-group">
                                <input type="password"
                                       name="password"
                                       id="id_password"
                                       class="form-control form-control-lg"
                                       placeholder="Введите пароль"
                                       required>
                                <button class="btn btn-outline-secondary"
                                        type="button"
                                        onclick="togglePasswordVisibility('id_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                <a href="{% url 'users:password_reset' %}" class="text-decoration-none">
                                    Забыли пароль?
                                </a>
                            </div>
                        </div>

                        <!-- Запомнить меня -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       name="remember_me"
                                       id="remember_me"
                                       checked>
                                <label class="form-check-label" for="remember_me">
                                    Запомнить меня
                                </label>
                            </div>
                        </div>

                        <!-- Кнопка входа -->
                        <div class="d-grid mb-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-sign-in-alt me-2"></i>Войти
                            </button>
                        </div>

                        <!-- Разделитель -->
                        <div class="position-relative mb-4">
                            <hr>
                            <div class="position-absolute top-50 start-50 translate-middle bg-white px-3">
                                <span class="text-muted">Или</span>
                            </div>
                        </div>

                        <!-- Социальные сети -->
                        <div class="mb-4">
                            <div class="d-grid gap-2">
                                <a href="#" class="btn btn-outline-primary">
                                    <i class="fab fa-google me-2"></i>Войти через Google
                                </a>
                                <a href="#" class="btn btn-outline-primary">
                                    <i class="fab fa-vk me-2"></i>Войти через ВКонтакте
                                </a>
                            </div>
                        </div>

                        <!-- Ссылка на регистрацию -->
                        <div class="text-center">
                            <p class="mb-0">
                                Нет аккаунта?
                                <a href="{% url 'users:register' %}" class="text-decoration-none fw-semibold">
                                    Зарегистрируйтесь
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Информация для новых пользователей -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body p-4">
                    <h5 class="h6 mb-3">
                        <i class="fas fa-info-circle me-2 text-primary"></i>Почему стоит зарегистрироваться?
                    </h5>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            Добавляйте объявления о продаже авто
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            Сохраняйте понравившиеся объявления
                        </li>
                        <li>
                            <i class="fas fa-check text-success me-2"></i>
                            Получайте уведомления о новых предложениях
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Показать/скрыть пароль
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const button = input.nextElementSibling.querySelector('i');

    if (input.type === 'password') {
        input.type = 'text';
        button.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        button.className = 'fas fa-eye';
    }
}

// Автозаполнение для демо (удалить в продакшене)
document.addEventListener('DOMContentLoaded', function() {
    const demoUsers = [
        { username: 'demo_user', password: 'demopassword123' },
        { username: 'seller@example.com', password: 'seller123' },
        { username: 'buyer@example.com', password: 'buyer123' }
    ];

    // Добавляем кнопки для быстрого входа (только для разработки)
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        const quickLogin = document.createElement('div');
        quickLogin.className = 'card border-0 shadow-sm mt-4';
        quickLogin.innerHTML = `
            <div class="card-body p-3">
                <h6 class="h6 mb-3 text-muted">
                    <i class="fas fa-vial me-2"></i>Быстрый вход (для разработки)
                </h6>
                <div class="d-grid gap-2">
                    ${demoUsers.map(user => `
                        <button class="btn btn-sm btn-outline-secondary"
                                onclick="quickLogin('${user.username}', '${user.password}')">
                            ${user.username}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
        document.querySelector('.container').appendChild(quickLogin);
    }
});

// Функция быстрого входа
function quickLogin(username, password) {
    document.getElementById('id_username').value = username;
    document.getElementById('id_password').value = password;
    document.querySelector('form').submit();
}
</script>
{% endblock %}